# CustomValidator + HttpServiceResult - Quick Start

## ?? One-Minute Integration

### Step 1: Add Component Reference
```razor
<EditForm Model="@model" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <CustomValidator @ref="customValidator" />  <!-- Add this -->
    
    <!-- Your form fields -->
    
    <ValidationSummary />
    <MudButton ButtonType="ButtonType.Submit">Submit</MudButton>
</EditForm>
```

### Step 2: Update Submit Handler
```csharp
@code {
    private CustomValidator? customValidator;
    
    [Inject] private IHttpChangeService<User, UserModel, UserDto> UserService { get; set; } = default!;
    
    private async Task HandleValidSubmit()
    {
        var result = await UserService.AddAsync(model);
        
        if (!result.Success)
        {
            customValidator?.DisplayErrors(result);  // Add this one line!
            return;
        }
        
        // Handle success
    }
}
```

### That's It! ?

---

## ?? Visual Flow

```
???????????????????????????????????????????????????????????
?                    Your Blazor Form                      ?
???????????????????????????????????????????????????????????
?  <EditForm>                                             ?
?    <CustomValidator @ref="customValidator" />           ?
?    <MudTextField ... />                                 ?
?    <ValidationSummary />                                ?
?  </EditForm>                                            ?
???????????????????????????????????????????????????????????
                          ?
???????????????????????????????????????????????????????????
?              Form Submission Handler                     ?
???????????????????????????????????????????????????????????
?  var result = await HttpService.AddAsync(model);        ?
?                                                          ?
?  if (!result.Success)                                   ?
?      customValidator?.DisplayErrors(result);            ?
???????????????????????????????????????????????????????????
                          ?
???????????????????????????????????????????????????????????
?              CustomValidator Logic                       ?
???????????????????????????????????????????????????????????
?  1. Check: Is result.Success == false?                  ?
?     YES ? Continue | NO ? Return                        ?
?                                                          ?
?  2. Check: Are there errors?                            ?
?     YES ? Continue | NO ? Return                        ?
?                                                          ?
?  3. Try to parse as JSON dictionary                     ?
?     ???????????????????????????????????????            ?
?     ? SUCCESS          ? FAILURE           ?            ?
?  Field-specific    Form-level errors                    ?
?  validation        in ValidationSummary                 ?
?                                                          ?
?  • Email errors ? Email field                           ?
?  • Password errors ? Password field                     ?
?  • General errors ? ValidationSummary                   ?
???????????????????????????????????????????????????????????
                          ?
???????????????????????????????????????????????????????????
?                 User Sees Errors                         ?
???????????????????????????????????????????????????????????
?                                                          ?
?  Email: [_____________________]                         ?
?         ? Email is required                             ?
?         ? Email format is invalid                       ?
?                                                          ?
?  Password: [_____________________]                      ?
?           ? Password too short                          ?
?                                                          ?
?  Validation Summary:                                    ?
?  • Session expired                                      ?
?                                                          ?
?  [Submit]                                               ?
???????????????????????????????????????????????????????????
```

---

## ?? Error Type Detection

```
HttpServiceResult<T>.Errors
         ?
    Is it JSON?
         ?
    ???????????
    ?         ?
   YES       NO
    ?         ?
Parse as   Treat as
Dictionary Form-level
    ?         ?
Field     General
Errors    Errors
```

---

## ?? Common Patterns

### Pattern 1: Simple CRUD
```csharp
var result = await Service.AddAsync(model);

if (!result.Success)
{
    customValidator?.DisplayErrors(result);
    return;
}

NavigationManager.NavigateTo("/list");
```

### Pattern 2: With Loading State
```csharp
try
{
    isSubmitting = true;
    var result = await Service.AddAsync(model);
    
    if (!result.Success)
    {
        customValidator?.DisplayErrors(result);
        return;
    }
    
    NavigationManager.NavigateTo("/list");
}
finally
{
    isSubmitting = false;
}
```

### Pattern 3: With Exception Handling
```csharp
try
{
    var result = await Service.AddAsync(model);
    
    if (!result.Success)
    {
        customValidator?.DisplayErrors(result);
        return;
    }
    
    NavigationManager.NavigateTo("/list");
}
catch (HttpRequestException ex)
{
    Logger.LogError(ex, "Network error");
    customValidator?.AddError(string.Empty, "Network error occurred");
    customValidator?.NotifyValidationStateChanged();
}
```

---

## ? Before vs After

### Code Complexity
```
BEFORE: 25+ lines of manual error parsing
AFTER:   1 line with automatic detection
```

### Error Prone
```
BEFORE: Manual JSON parsing with try-catch
AFTER:  Automatic detection and parsing
```

### Consistency
```
BEFORE: Different patterns across forms
AFTER:  Same pattern everywhere
```

### Maintainability
```
BEFORE: Changes needed in every form
AFTER:  Changes in one component
```

---

## ?? Supported Scenarios

| Scenario | Code | Result |
|----------|------|--------|
| **Create** | `Service.AddAsync(model)` | Validation errors in form |
| **Update** | `Service.UpdateAsync(model)` | Validation errors in form |
| **Delete** | `Service.DeleteAsync(id)` | Error message in summary |
| **Get** | `Service.GetAsync(id)` | Error message in summary |
| **Batch** | `Service.AddRangeAsync(models)` | Validation errors in form |

---

## ?? Learn More

| Document | Description |
|----------|-------------|
| [Quick Start](#) | This document |
| [Complete Guide](./HTTPSERVICERESULT_INTEGRATION.md) | Full examples and patterns |
| [API Docs](./CustomValidator.README.md) | All methods and properties |
| [Summary](./HTTPSERVICERESULT_SUMMARY.md) | Benefits and migration |

---

## ?? Tips

1. **Always clear errors** before submission
   ```csharp
   customValidator?.ClearErrors();
   ```

2. **Check HasErrors** if needed
   ```csharp
   if (customValidator?.HasErrors ?? false)
       return;
   ```

3. **Use loading states** for better UX
   ```csharp
   isSubmitting = true;
   try { /* ... */ }
   finally { isSubmitting = false; }
   ```

4. **Handle exceptions** gracefully
   ```csharp
   catch (Exception ex)
   {
       customValidator?.AddError(string.Empty, "Error occurred");
       customValidator?.NotifyValidationStateChanged();
   }
   ```

---

## ? Checklist

- [ ] Added `CustomValidator` component to form
- [ ] Added `@ref="customValidator"` attribute
- [ ] Injected HTTP service
- [ ] Updated submit handler
- [ ] Added `customValidator?.DisplayErrors(result)`
- [ ] Tested field-specific errors
- [ ] Tested form-level errors
- [ ] Added loading state (optional)
- [ ] Added exception handling (optional)

---

**?? You're Done!** Your form now has automatic error handling with just one line of code.

**Questions?** See [HTTPSERVICERESULT_INTEGRATION.md](./HTTPSERVICERESULT_INTEGRATION.md) for detailed examples.
