@using Craft.Core
@using Craft.Domain
@using Craft.QuerySpec
@using MudBlazor

@namespace Craft.UiBuilders.Components

@inherits CraftComponent

@typeparam TEntity where TEntity : class, IEntity, IModel, new()

<CascadingValue Value="this" Name="Grid" IsFixed="true">
    @ChildContent
</CascadingValue>

@if (_showDataGrid)
{
    @* Table View (DataGrid) *@
    <CraftDataGrid TEntity="TEntity"
                   HttpService="@HttpService"
                   QueryBuilder="@QueryBuilder"
                   Title="@Title"
                   Class="@Class"
                   Hover="@Hover"
                   Striped="@Striped"
                   Dense="@Dense"
                   Bordered="@Bordered"
                   FixedHeader="@FixedHeader"
                   Height="@Height"
                   LoadingProgressColor="@LoadingProgressColor"
                   EnablePagination="@EnablePagination"
                   InitialPageSize="@InitialPageSize"
                   PageSizeOptions="@PageSizeOptions"
                   RowsPerPageString="@RowsPerPageString"
                   InfoFormat="@InfoFormat"
                   ShowActions="@ShowActions"
                   ShowSearch="@ShowSearch"
                   SearchPlaceholder="@SearchPlaceholder"
                   AllowRefresh="@AllowRefresh"
                   AllowAdd="@AllowAdd"
                   AddButtonText="@AddButtonText"
                   AddIcon="@AddIcon"
                   AllowView="@AllowView"
                   AllowEdit="@AllowEdit"
                   AllowDelete="@AllowDelete"
                   AllowExport="@AllowExport"
                   NoRecordsMessage="@NoRecordsMessage"
                   LoadingMessage="@LoadingMessage"
                   DeleteConfirmationMessage="@DeleteConfirmationMessage"
                   OnAdd="@OnAdd"
                   OnView="@OnView"
                   OnEdit="@OnEdit"
                   OnDelete="@OnDelete"
                   OnExport="@OnExport"
                   OnDataLoaded="@OnDataLoaded">
        @foreach (var column in Columns.Where(c => c.Visible))
        {
            <CraftDataGridColumn TEntity="TEntity"
                                 PropertyExpression="@column.PropertyExpression"
                                 Title="@column.Title"
                                 Sortable="@column.Sortable"
                                 Searchable="@column.Searchable"
                                 Format="@column.Format"
                                 Width="@column.Width"
                                 MinWidth="@column.MinWidth"
                                 MaxWidth="@column.MaxWidth"
                                 Alignment="@column.Alignment"
                                 DefaultSort="@column.DefaultSort"
                                 SortOrder="@column.SortOrder"
                                 Template="@column.Template" />
        }
    </CraftDataGrid>
}

@if (_showCardGrid)
{
    @* Card View (CardGrid) *@
    <CraftCardGrid TEntity="TEntity"
                   HttpService="@HttpService"
                   QueryBuilder="@QueryBuilder"
                   Title="@Title"
                   Class="@Class"
                   CardClass="@CardClass"
                   CardStyle="@CardStyle"
                   CardGridClass="@CardGridClass"
                   CardElevation="@CardElevation"
                   CardSpacing="@CardSpacing"
                   CardXs="@CardXs"
                   CardSm="@CardSm"
                   CardMd="@CardMd"
                   CardLg="@CardLg"
                   CardXl="@CardXl"
                   EnablePagination="@EnablePagination"
                   InitialPageSize="@InitialPageSize"
                   PaginationInfoFormat="@PaginationInfoFormat"
                   ShowActions="@ShowActions"
                   ShowSearch="@ShowSearch"
                   SearchPlaceholder="@SearchPlaceholder"
                   AllowRefresh="@AllowRefresh"
                   AllowAdd="@AllowAdd"
                   AddButtonText="@AddButtonText"
                   AddIcon="@AddIcon"
                   AllowView="@AllowView"
                   AllowEdit="@AllowEdit"
                   AllowDelete="@AllowDelete"
                   AllowExport="@AllowExport"
                   NoRecordsMessage="@NoRecordsMessage"
                   LoadingMessage="@LoadingMessage"
                   DeleteConfirmationMessage="@DeleteConfirmationMessage"
                   OnAdd="@OnAdd"
                   OnView="@OnView"
                   OnEdit="@OnEdit"
                   OnDelete="@OnDelete"
                   OnExport="@OnExport"
                   OnDataLoaded="@OnDataLoaded">
        @foreach (var column in Columns.Where(c => c.IsVisibleInCardView))
        {
            <CraftCardGridColumn TEntity="TEntity"
                                 PropertyExpression="@column.PropertyExpression"
                                 Caption="@column.Title"
                                 FieldType="@column.ResolvedCardFieldType"
                                 Sortable="@column.Sortable"
                                 Searchable="@column.Searchable"
                                 Format="@column.Format"
                                 DefaultSort="@column.DefaultSort"
                                 SortOrder="@column.SortOrder"
                                 Template="@column.Template"
                                 Visible="@column.Visible" />
        }
    </CraftCardGrid>
}
