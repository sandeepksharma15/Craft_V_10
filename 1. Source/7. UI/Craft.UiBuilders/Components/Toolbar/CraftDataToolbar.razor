@using Craft.QuerySpec
@using Craft.UiBuilders.Generic
@using MudBlazor

@namespace Craft.UiBuilders.Components

@typeparam TEntity where TEntity : class

<MudPaper Class="pa-2 mb-2">
    <CraftDiv Class="d-flex align-center gap-2" Style="flex-wrap: nowrap;">
        
        @* Left Section: Filter Area (can wrap) *@
        <Show When="@ShowSearch">
            <CraftDiv Class="flex-grow-1" Style="min-width: 0;">
                <CraftAdvancedSearch TEntity="TEntity" SearchableColumns="@SearchableColumns" @bind-FilterBuilder="@FilterBuilder" 
                                     OnFiltersChanged="@OnFiltersChanged" />
            </CraftDiv>
        </Show>

        @* Spacer to push right section to the end *@
        <CraftDiv Class="flex-grow-1"></CraftDiv>

        @* Right Section: Action Buttons (stay together) *@
        <CraftDiv Class="d-flex align-center gap-2" Style="flex-shrink: 0;">
            
            @* Sort Menu *@
            <Show When="@ShowSort">
                @SortContent
            </Show>

            @* Export Menu *@
            <Show When="@ShowExport">
                <MudMenu Icon="@Icons.Material.Filled.FileDownload" Color="Color.Default" Variant="Variant.Outlined" Size="Size.Medium">
                    <MudMenuItem OnClick="@(() => OnExport.InvokeAsync(ExportFormat.Csv))" Icon="@Icons.Material.Filled.Description">
                        Export to CSV
                    </MudMenuItem>
                    <MudMenuItem OnClick="@(() => OnExport.InvokeAsync(ExportFormat.Excel))" Icon="@Icons.Material.Filled.TableChart">
                        Export to Excel
                    </MudMenuItem>
                    <MudMenuItem OnClick="@(() => OnExport.InvokeAsync(ExportFormat.Pdf))" Icon="@Icons.Material.Filled.PictureAsPdf">
                        Export to PDF
                    </MudMenuItem>
                </MudMenu>
            </Show>

            @* Refresh Button *@
            <Show When="@ShowRefresh">
                <MudIconButton Icon="@Icons.Material.Filled.Refresh" Color="Color.Default" OnClick="@OnRefresh" />
            </Show>

            @* Add Button *@
            <Show When="@ShowAdd">
                <MudButton Color="Color.Primary" Variant="Variant.Filled" StartIcon="@AddIcon" OnClick="@OnAdd">
                    @AddButtonText
                </MudButton>
            </Show>
        </CraftDiv>
    </CraftDiv>
</MudPaper>
